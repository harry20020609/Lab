# Lab3

201250203 张若皓

## 实验思路

整体实验的思路其实和Lab3有点类似。

对于return中返回的exp语句，对其进行判断以后（就是判断其到底属于哪一类语句MUL，ADD等）进入对应的visitxxx语句。因为此次实验中返回的值都是常数，所以最后都会落在visitNumber语句中，在visit Number语句中处理这个常数的值（例如切换进制），将其保存在LLVMValueRef中后返回。

## 精巧设计

本次实验中，我并没有什么精巧设计，但我有很烂的设计。

因为最后要在Main函数中输出，所以我的LLVMContext、LLVMModule以及LLVMBuilder都在Main函数中定义，然后传递给Visitor中。（我觉得应该是有更好的办法处理这个内容的。

此外，在访问visitAddExp、visitMulExp等方法中，因为害怕递归的情况出现，所以每一个exp都要进行判断。这样所带来的劣势就是会有很多代码都是重复的。我本来考虑将这些重复代码抽取出来做一个函数，但是本质上他们的ctx不是同一个类，抽取出来的函数也会非常复杂。所以最后我还是没有修改，visitAddExp、visitMulExp等方法中还是有非常多重复代码。

## 你遇到的困难及解决办法**(**遇到的奇怪**bug)**

遇到的困难就是不太了解LLVM到底怎么使用。然后网上也没有特别详细的教程。最后靠着我直接看别人的代码（助教给的代码和网上其他人的LLVM代码），大概总结出来一个框架是怎么使用。此外，遇到不会的就直接问ChatGPT。不过如果直接问他LLVM怎么写，它给出的初始化方法和我们所用的不太一样。不过在我写代码的过程中还是给了我很大帮助的。

最后，非常经典的fail to make，询问助教以后 把我文件中多余的import语句删除即可。在此过程中，助教还发现我本地似乎不能通过make antlr创建文件（我一般直接右键然后点击generate按钮），不过并不影响完成实验。