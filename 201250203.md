# Lab8（bonus）

201250203 张若皓

## 实验思路

将函数中的数组作为指针传入。

在调用函数的时候，需要做特殊处理。需要在访问lvalExp的时候确定现在访问的这个变量是否作为函数中的参数。如果是的话，就需要将这个参数特别进行处理。不能和之前一样对数组进行处理，要取这个数组（变量）的第一个元素的地址，然后直接返回。

## 精巧设计

没有精巧设计。

## 你遇到的困难及解决办法**(**遇到的奇怪**bug)**

碰到的问题不多。

主要的问题还是不知道如何将数组作为指针传入。研究了很久，根据助教给出的代码，尝试了很多次。刚开始的时候，有很多时候不知道怎么传arrayType作为参数给函数（其实不是传arrayType，传的是一个pointer）。

其次的问题就是，在实验思路中所提到的：在调用函数的时候，需要做特殊处理。需要在访问lvalExp的时候确定现在访问的这个变量是否作为函数中的参数。最后选择的方法其实不太好，我在符号表中保存的是一个pointer，所以没法直接判断一个LLVMValueRef的类型，我选择的方法是将其先进行BuildLoad（这个指令并不会对后续造成影响），然后进行判断BuildLoad的返回结果的类型（数组还是普通int），从而实现在visitLval的时候进行判断传入的参数是什么类型，从而生成不同的中间代码。

最后的问题是，oj上还是有两个报错（似乎是有一部分应该有代码的地方没有，导致报错），不过已经拿了4分额外分，我就不想再纠结这些内容（也没法问助教😭）。
