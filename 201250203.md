# Lab6

201250203 张若皓

## 实验思路

对于全局变量来说，我在变量定义之前做了一个判断——判断当前的Scope是否为GlobalScope。如果是GlobalScope，那么接下来定义的变量作为全局变量进行定义。Const同理。

对于if判断语句来说，并没有什么特别的。在visitStmt时进行操作。先通过访问cond语句来获得condition(i32类型，需要转化一步），然后创建block，并做LLVMPositionBuilderAtEnd和访问某个块内部的内容。

对于不同的cond类型，做不同操作。

对于ExpCond类型，就是访问exp。

对于其他类型，都是先访问左右两边的cond，然后再使用icmp。

在这些cond类型中，返回的都是i32类型，方便我们进行判断，传给visitStmt也为i32类型，最后由visitStmt来进行转化为i1类型。

## 精巧设计

实在是没有什么精巧设计。

写得很烂的是，visit不同类型的cond时候，通过instanceof判断其类型的时候，代码冗余非常多。（和我写的visitMul等等一样）

## 你遇到的困难及解决办法**(**遇到的奇怪**bug)**

碰到两个问题。

第一个是在处理if(a)的时候。（a为变量）

我当时使用的是，在visitExpCond的时候将返回值设置为了一个i32类型的1。（就是我直接判断了a是否为0，然后将这个判断结果转化成了一个i32类型。）这样做会导致我在处理a<b这种情况的时候出现错误，所以我就直接返回了它原本的值。有点愚蠢，写的时候没怎么考虑。

第二个是在oj上有一个error: instruction expected to be numbered '%1' 报错。

上网查了一下，好像是因为llvmvalueref如果没设置名字的话，如果自动生成的名字不连续就会错误？（我没太理解）

解决方案是我将之前没有设置名字的llvmvalueref都设置了一个名字，就能够解决。

